DROP TABLE IF EXISTS express_scripts_rx_raw;
CREATE TABLE express_scripts_rx_raw (
creation_date text encode lzo,
creation_time text encode lzo,
version_number text encode lzo,
transaction_code text encode lzo,
processor_control_number text encode lzo,
service_provider_id text encode lzo,
service_provider_id_qualifier text encode lzo,
date_of_service text encode lzo,
date_of_birth text encode lzo,
patient_gender_code text encode lzo,
patient_first_name text encode lzo,
patient_last_name text encode lzo,
patient_street_address text encode lzo,
paitent_city text encode lzo,
patient_state text encode lzo,
patient_zip text encode lzo,
patient_id_qualifier text encode lzo,
patient_id text encode lzo,
provider_id text encode lzo,
provider_id_qualifier text encode lzo,
prescriber_id text encode lzo,
primary_care_provider_id text encode lzo,
prescriber_last_name text encode lzo,
prescriber_id_qualifier text encode lzo,
cardholder_id text encode lzo,
group_id text encode lzo,
patient_relationship_code text encode lzo,
prescription_service_reference_number text encode lzo,
fill_number text encode lzo,
days_supply text encode lzo,
compound_code text encode lzo,
product_service_id text encode lzo,
dispense_as_written text encode lzo,
date_prescription_written text encode lzo,
number_of_refills_authorized text encode lzo,
level_of_service text encode lzo,
unit_dose_indicator text encode lzo,
product_service_id_qualifier text encode lzo,
quantity_dispensed text encode lzo,
prescription_service_reference_number_qualifier text encode lzo,
unit_of_measure text encode lzo,
diagnosis_code text encode lzo,
diagnosis_code_qualifier text encode lzo,
response_code text encode lzo,
reject_code_1 text encode lzo,
reject_code_2 text encode lzo,
reject_code_3 text encode lzo,
reject_code_4 text encode lzo,
reject_code_5 text encode lzo,
unique_patient_id text encode lzo,
pharmacy_claim_id text encode lzo,
pharmacy_claim_ref_id text encode lzo,
taxonomy_code text encode lzo,
hv_join_key text encode lzo
) DISTKEY(hv_join_key) SORTKEY(hv_join_key);    -- hvJoinKey to match the deid'd PHI

-- Load transaction data into table
copy express_scripts_rx_raw from :input_path credentials :credentials BZIP2 EMPTYASNULL TRIMBLANKS FIXEDWIDTH 'creation_date:8,creation_time:6,version_number:2,transaction_code:2,processor_control_number:10,service_provider_id:15,service_provider_id_qualifier:2,date_of_service:8,date_of_birth:8,patient_gender_code:1,patient_first_name:25,patient_last_name:35,patient_street_address:30,paitent_city:30,patient_state:2,patient_zip:5,patient_id_qualifier:2,patient_id:20,provider_id:15,provider_id_qualifier:2,prescriber_id:15,primary_care_provider_id:15,prescriber_last_name:25,prescriber_id_qualifier:2,cardholder_id:30,group_id:18,patient_relationship_code:1,prescription_service_reference_number:12,fill_number:5,days_supply:5,compound_code:1,product_service_id:19,dispense_as_written:1,date_prescription_written:8,number_of_refills_authorized:5,level_of_service:2,unit_dose_indicator:1,product_service_id_qualifier:2,quantity_dispensed:11,prescription_service_reference_number_qualifier:1,unit_of_measure:2,diagnosis_code:15,diagnosis_code_qualifier:2,response_code:1,reject_code_1:3,reject_code_2:3,reject_code_3:3,reject_code_4:3,reject_code_5:3,unique_patient_id:15,pharmacy_claim_id:44,pharmacy_claim_ref_id:44,taxonomy_code:10,v_join_key:36';
